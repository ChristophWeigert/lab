networks:
  proxy:
    external: true

# If you change the FLASK_PORT, do not forget to change it in ports and healthcheck as well.
services:
  calibre-web-automated-book-downloader:
    image: ghcr.io/calibrain/calibre-web-automated-book-downloader:latest@sha256:40b3cc61af4292d2d622ad7f80440adc329b3907d3e33e987ead4ba424367e37
    networks: 
      - proxy
    environment:
      FLASK_PORT: 8084
      FLASK_DEBUG: false
      INGEST_DIR: /cwa-book-ingest
      BOOK_LANGUAGE: de,en
      TZ: Europe/Berlin
      APP_ENV: prod
      UID: 1000
      GID: 1000
      CUSTOM_DNS: cloudflare
      USE_DOH: true
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.calibre-dl.entryPoints=websecure"
      - "traefik.http.routers.calibre-dl.tls.certResolver=production"
      - "traefik.http.routers.calibre-dl.rule=Host(`calibre-dl.$DOMAIN`)"
      - "traefik.http.services.calibre-dl.loadbalancer.server.port=8084"
    volumes:
      - /mnt/media/books-ingest:/cwa-book-ingest

