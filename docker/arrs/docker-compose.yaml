---
networks:
  proxy:
    external: true
  arrs:

volumes:
  sabnzbd: {}
  jellyseerr: {}
  bazarr: {}
  sonarr: {}
  readarr: {}
  lidarr: {}
  radarr: {}
  prowlarr: {}
  mediathekarr: {}
  configarr: {}
  downloads_completed:
    driver_opts:
      type: "nfs"
      o: "nfsvers=4,addr=192.168.1.14,rw"
      device: ":/mnt/pool-main/media/downloads/completed"
  downloads_incompleted:
    driver_opts:
      type: "nfs"
      o: "nfsvers=4,addr=192.168.1.14,rw"
      device: ":/mnt/pool-main/media/downloads/incompleted"
  media_tv:
    driver_opts:
      type: "nfs"
      o: "nfsvers=4,addr=192.168.1.14,rw"
      device: ":/mnt/pool-main/media/tv"
  media_books:
    driver_opts:
      type: "nfs"
      o: "nfsvers=4,addr=192.168.1.14,rw"
      device: ":/mnt/pool-main/media/books"
  media_music:
    driver_opts:
      type: "nfs"
      o: "nfsvers=4,addr=192.168.1.14,rw"
      device: ":/mnt/pool-main/media/music"
  media_movies:
    driver_opts:
      type: "nfs"
      o: "nfsvers=4,addr=192.168.1.14,rw"
      device: ":/mnt/pool-main/media/movies"

services:
  sabnzbd:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    container_name: sabnzbd
    image: ghcr.io/linuxserver/sabnzbd:4.5.5@sha256:1a26f56dfc047b62d5ddc20bc92bdebfbe7c3cb58d2d3523958838a09182d77a
    volumes:
      - sabnzbd:/config
      - downloads_completed:/downloads # completed directory for downloads. this contains the category directories
      - downloads_incompleted:/incomplete-downloads # "temp" directory for downloads
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.sabnzbd.entryPoints=websecure"
      - "traefik.http.routers.sabnzbd.tls.certResolver=production"
      - "traefik.http.routers.sabnzbd.rule=Host(`sabnzbd.$DOMAIN`)"
      - "traefik.http.routers.sabnzbd.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.sabnzbd.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.routers.sabnzbd.tls=true"
      - "traefik.docker.network=proxy"

  jellyseerr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: ghcr.io/fallenbagel/jellyseerr:2.7.3@sha256:9cc9e9ee6cd5cf5a23feb45c37742ba34cfd6314d81d259cddb373a97ac92cdd
    container_name: jellyseerr
    environment:
      - LOG_LEVEL=debug
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.jellyseerr.entryPoints=websecure"
      - "traefik.http.routers.jellyseerr.tls.certResolver=production"
      - "traefik.http.routers.jellyseerr.rule=Host(`request.$DOMAIN`)"
      - "traefik.http.routers.jellyseerr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.jellyseerr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.routers.jellyseerr.tls=true"
    volumes:
      - jellyseerr:/app/config

  sonarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: ghcr.io/linuxserver/sonarr:4.0.16@sha256:37be832b78548e3f55f69c45b50e3b14d18df1b6def2a4994258217e67efb1a1
    container_name: sonarr
    environment:
      - DOCKER_MODS=ghcr.io/gilbn/theme.park:sonarr
      - TP_THEME=organizr
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    volumes:
      - sonarr:/config
      - media_tv:/tv
      - downloads_completed:/downloads
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.sonarr.entryPoints=websecure"
      - "traefik.http.routers.sonarr.tls.certResolver=production"
      - "traefik.http.routers.sonarr.rule=Host(`sonarr.$DOMAIN`)"
      - "traefik.http.routers.sonarr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.sonarr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.services.sonarr.loadbalancer.server.port=8989"
      - "traefik.port=8989"

  bazarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: ghcr.io/linuxserver/bazarr:1.5.5@sha256:18ff732dffcebd559d15a91845fc3360d49652ea01dccfbfd98b8248ceb86e38
    container_name: bazarr
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    volumes:
      - bazarr:/config
      - media_tv:/media/tv
      - media_movies:/media/movies
      - media_books:/media/books
      - media_music:/media/music
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.bazarr.entryPoints=websecure"
      - "traefik.http.routers.bazarr.tls.certResolver=production"
      - "traefik.http.routers.bazarr.rule=Host(`bazarr.$DOMAIN`)"
      - "traefik.http.routers.bazarr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.bazarr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.services.bazarr.loadbalancer.server.port=6767"
      - "traefik.port=6767"
  
  readarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: ghcr.io/linuxserver/readarr:0.4.19-nightly@sha256:4f291128d1a5538be73c2a30473d7cdd0820e223dc8b8533b0cbc5659000dcbe
    container_name: readarr
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    volumes:
      - readarr:/config
      - media_books:/books
      - downloads_completed:/downloads
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.readarr.entryPoints=websecure"
      - "traefik.http.routers.readarr.tls.certResolver=production"
      - "traefik.http.routers.readarr.rule=Host(`readarr.$DOMAIN`)"
      - "traefik.http.routers.readarr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.readarr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.services.readarr.loadbalancer.server.port=8787"
      - "traefik.port=8787"
  
  lidarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: blampe/lidarr:latest@sha256:37cda9b639588faef8b82cda286948d29b947ece80f8c93cccb5b9141d4a25c0
    container_name: lidarr
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    volumes:
      - lidarr:/config
      - media_music:/music
      - downloads_completed:/downloads
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.lidarr.entryPoints=websecure"
      - "traefik.http.routers.lidarr.tls.certResolver=production"
      - "traefik.http.routers.lidarr.rule=Host(`lidarr.$DOMAIN`)"
      - "traefik.http.routers.lidarr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.lidarr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.services.lidarr.loadbalancer.server.port=8686"
      - "traefik.port=8686"
  
  radarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: ghcr.io/linuxserver/radarr:6.0.4@sha256:f08dda38e7d12e5a722d9a5cb6e54acaf63c8598fefeefec88effe0c0d0038dd
    container_name: radarr
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    volumes:
      - radarr:/config
      - media_movies:/movies
      - downloads_completed:/downloads
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.radarr.entryPoints=websecure"
      - "traefik.http.routers.radarr.tls.certResolver=production"
      - "traefik.http.routers.radarr.rule=Host(`radarr.$DOMAIN`)"
      - "traefik.http.routers.radarr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.radarr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.services.radarr.loadbalancer.server.port=7878"
  
  prowlarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: ghcr.io/linuxserver/prowlarr:2.3.0@sha256:e74a1e093dcc223d671d4b7061e2b4946f1989a4d3059654ff4e623b731c9134
    container_name: prowlarr
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
    volumes:
      - prowlarr:/config
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.prowlarr.entryPoints=websecure"
      - "traefik.http.routers.prowlarr.tls.certResolver=production"
      - "traefik.http.routers.prowlarr.rule=Host(`prowlarr.$DOMAIN`)"
      - "traefik.http.routers.prowlarr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.prowlarr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.services.prowlarr.loadbalancer.server.port=9696"

  umlautadaptarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    container_name: umlautadaptarr
    ports:
      - "5006:5006"
    image: pcjones/umlautadaptarr:0.7.5@sha256:2c6689d49afe51fcaa5e8a27e139855e0c8782e1e42ec595d8694b74094f991f
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
      - SONARR__ENABLED=true
      - SONARR__HOST=https://sonarr.$DOMAIN
      - SONARR__APIKEY=$SONARR_APIKEY
      - RADARR__ENABLED=true
      - RADARR__HOST=https://radarr.$DOMAIN
      - RADARR__APIKEY=$RADARR_APIKEY
      - READARR__ENABLED=true
      - READARR__HOST=https://readarr.$DOMAIN
      - READARR__APIKEY=$READARR_APIKEY
      - LIDARR__ENABLED=true
      - LIDARR__HOST=https://lidarr.$DOMAIN
      - LIDARR__APIKEY=$LIDARR_APIKEY

  mediathekarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: pcjones/mediathekarr:beta@sha256:c1cf5b8c2f775f3bfe846f0217af0fe568b0d5e29330ce65020cd0f0871b315c
    container_name: mediathekarr
    environment:
      - TZ=Europe/Berlin
      - PUID=1000
      - PGID=1000
      - DOWNLOAD_INCOMPLETE_PATH=/incomplete-downloads
      - DOWNLOAD_COMPLETE_PATH=/downloads
      - MEDIATHEKARR_API_BASE_URL=https://mediathekarr.pcjones.de/api/v1
    volumes:
      - mediathekarr:/app/config
      - downloads_completed:/downloads
      - downloads_incompleted:/incomplete-downloads
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.mediathekarr.entryPoints=websecure"
      - "traefik.http.routers.mediathekarr.tls.certResolver=production"
      - "traefik.http.routers.mediathekarr.rule=Host(`mediathekarr.$DOMAIN`)"
      - "traefik.http.routers.mediathekarr.tls.domains[0].main=$DOMAIN"
      - "traefik.http.routers.mediathekarr.tls.domains[0].sans=*.$DOMAIN"
      - "traefik.http.services.mediathekarr.loadbalancer.server.port=5007"

  configarr:
    networks: [ arrs, proxy ]
    restart: unless-stopped
    image: ghcr.io/raydak-labs/configarr:1.20.0@sha256:40180ae49ed3caab864f65682da14b172281edb19924e60a5fd357b2234cb987
    container_name: configarr
    volumes:
      - configarr:/app
    environment:
      - TZ=Europe/Berlin